<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Handelsspiel – Elandor</title>
  <style>
    body {
      background: #f4f1e5;
      font-family: 'Georgia', serif;
      margin: 0;
    }
    header {
      background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/f/fd/Parchment_texture.jpg/800px-Parchment_texture.jpg');
      background-size: cover;
      padding: 10px;
      text-align: center;
    }
    nav {
      display: flex;
      justify-content: center;
      background: #6b4f2d;
    }
    nav button {
      background: #8b5e3c;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
      border-radius: 8px;
    }
    nav button:hover {
      background: #a97144;
    }
    #karte {
      width: 100%;
      height: 400px;
      background: #cceeff; /* Blauer Hintergrund für Wasser/Meer, wird vom Bild überdeckt */
    }
    #inhalt {
      padding: 20px;
      background: #fffdf7;
      border: 1px solid #ddd;
      margin: 10px;
      border-radius: 8px;
    }
    .stadt-button {
      fill: #3366cc; /* Standardfarbe für Städte */
      cursor: pointer;
      transition: fill 0.2s, r 0.2s; /* Sanfter Übergang für Hover/Auswahl */
    }
    .stadt-button:hover {
      fill: #5588ee;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    td, th {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left; /* Text linksbündig für bessere Lesbarkeit */
    }
    th {
      background-color: #f2f2f2;
    }
    button {
      background: #4CAF50; /* Grün für Aktionen */
      color: white;
      border: none;
      padding: 5px 10px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 2px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background: #45a049;
    }
    input[type="number"] {
        width: 60px;
        padding: 5px;
        margin-right: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
  </style>
</head>
<body>

<header>
  <h1>Handelsspiel – Elandor</h1>
</header>

<nav>
  <button onclick="zeigeMenue('uebersicht')">Übersicht</button>
  <button onclick="zeigeMenue('handel')">Handel</button>
  <button onclick="zeigeMenue('gebaeude')">Gebäude</button>
  <button onclick="zeigeMenue('schiffe')">Schiffe</button>
</nav>

<div id="spielerStatus" style="padding: 10px; background: #e0d8c1; border: 1px solid #c0b8a1; margin: 10px; border-radius: 8px;">
  <h3>Dein Status:</h3>
  <p>Gold: <span id="goldAnzeige"></span></p>
  <p>Level: <span id="levelAnzeige"></span> (<span id="xpAnzeige"></span> XP)</p>
  <p>Aktuelle Stadt: <span id="aktuelleStadtAnzeige">Keine</span></p>
  <p>Ladekapazität: <span id="ladekapazitaetAnzeige"></span></p>
</div>

<svg id="karte" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
  <rect width="1000" height="600" fill="#cceeff" />
  <image href="https://raw.githubusercontent.com/ebrius0/Handelsspiel/main/file_0000000020d861fb8c92bec003f416bd%20(1).png" x="0" y="0" height="600" width="1000" preserveAspectRatio="xMidYMid slice"/>
</svg>

<div id="inhalt">
  <p>Lade Spiel...</p>
</div>

<script>
  // --- SPIELERDATEN ---
  const SPIELER_DATEN = {
    gold: 5000, // Startkapital erhöht für besseres Testen
    level: 1,
    xp: 0,
    aktuelleStadt: null,
    schiffeBesitz: [], // Hier speichern wir Schiffe, die der Spieler besitzt
    inventar: {}, // z.B. { 'Getreide': 10, 'Holz': 5 } - gesamt über alle Schiffe
    gebaeude: {} // z.B. { 'Elandor': { 'Lagerhaus': 1 } }
  };

  // --- STÄDTEDATEN ---
  // Koordinaten sind Platzhalter und MÜSSEN manuell an deine gewählte Karte angepasst werden!
  const STAEDTE = {
    'Küstenstadt A': { x: 150, y: 100, einwohner: 1000, versorgung: 'Gut',
      gueter: {
        'Fisch': { basisPreis: 12, lager: 50, produktionsFaktor: 0.8 }, // Produziert Fisch (günstiger verkauft)
        'Salz': { basisPreis: 18, lager: 30, produktionsFaktor: 1.0 }  // Standardpreis
      }
    },
    'Küstenstadt B': { x: 300, y: 80, einwohner: 950, versorgung: 'Mittel',
      gueter: {
        'Holz': { basisPreis: 15, lager: 40, produktionsFaktor: 0.9 },
        'Tuch': { basisPreis: 25, lager: 20, produktionsFaktor: 1.0 }
      }
    },
    'Küstenstadt C': { x: 450, y: 120, einwohner: 1100, versorgung: 'Sehr Gut',
      gueter: {
        'Wein': { basisPreis: 20, lager: 30, produktionsFaktor: 0.85 },
        'Getreide': { basisPreis: 16, lager: 60, produktionsFaktor: 0.9 }
      }
    },
    'Küstenstadt D': { x: 600, y: 150, einwohner: 800, versorgung: 'Schlecht',
      gueter: {
        'Eisen': { basisPreis: 30, lager: 10, produktionsFaktor: 1.0 },
        'Werkzeuge': { basisPreis: 40, lager: 12, produktionsFaktor: 1.1 } // Benötigt Werkzeuge (teurer verkauft)
      }
    },
    'Küstenstadt E': { x: 750, y: 200, einwohner: 1300, versorgung: 'Gut',
      gueter: {
        'Silber': { basisPreis: 50, lager: 5, produktionsFaktor: 0.8 },
        'Juwelen': { basisPreis: 100, lager: 2, produktionsFaktor: 0.9 }
      }
    },
    'Küstenstadt F': { x: 880, y: 300, einwohner: 900, versorgung: 'Mittel',
      gueter: {
        'Gewürze': { basisPreis: 60, lager: 7, produktionsFaktor: 0.85 },
        'Seide': { basisPreis: 80, lager: 5, produktionsFaktor: 0.9 }
      }
    },
    'Küstenstadt G': { x: 800, y: 450, einwohner: 1500, versorgung: 'Hervorragend',
      gueter: {
        'Waffen': { basisPreis: 70, lager: 8, produktionsFaktor: 0.9 },
        'Rüstungen': { basisPreis: 90, lager: 4, produktionsFaktor: 0.9 }
      }
    },
    'Küstenstadt H': { x: 650, y: 520, einwohner: 1200, versorgung: 'Gut',
      gueter: {
        'Gold': { basisPreis: 120, lager: 3, produktionsFaktor: 0.8 },
        'Kräuter': { basisPreis: 22, lager: 25, produktionsFaktor: 1.0 }
      }
    },
    'Flussstadt A': { x: 350, y: 300, einwohner: 700, versorgung: 'Mittel',
      gueter: {
        'Getreide': { basisPreis: 10, lager: 60, produktionsFaktor: 0.8 },
        'Holz': { basisPreis: 15, lager: 50, produktionsFaktor: 0.9 }
      }
    },
    'Flussstadt B': { x: 550, y: 400, einwohner: 900, versorgung: 'Schlecht',
      gueter: {
        'Kohle': { basisPreis: 20, lager: 30, produktionsFaktor: 0.85 },
        'Erz': { basisPreis: 30, lager: 20, produktionsFaktor: 0.9 }
      }
    },
    'Inselstadt 1': { x: 100, y: 450, einwohner: 600, versorgung: 'Sehr Schlecht',
      gueter: {
        'Exotische Früchte': { basisPreis: 45, lager: 10, produktionsFaktor: 0.9 },
        'Muscheln': { basisPreis: 15, lager: 50, produktionsFaktor: 0.8 }
      }
    },
    'Inselstadt 2': { x: 900, y: 100, einwohner: 1000, versorgung: 'Gut',
      gueter: {
        'Perlen': { basisPreis: 60, lager: 7, produktionsFaktor: 0.8 },
        'Rum': { basisPreis: 80, lager: 5, produktionsFaktor: 0.9 }
      }
    }
  };

  // --- SCHIFFS_TYPEN ---
  const SCHIFFS_TYPEN = [
    { name: 'Schnigge', levelNoetig: 1, kapazitaet: 50, preis: 500 },
    { name: 'Kraier', levelNoetig: 10, kapazitaet: 150, preis: 2000 },
    { name: 'Kogge', levelNoetig: 20, kapazitaet: 300, preis: 5000 },
    { name: 'Holk', levelNoetig: 30, kapazitaet: 600, preis: 10000 }
  ];

  // --- GEBÄUDE_TYPEN ---
  const GEBAEUDE_TYPEN = {
    'Lagerhaus': { kosten: 100, beschreibung: 'Erhöht Lagerplatz.' },
    'Kontor': { kosten: 200, beschreibung: 'Ermöglicht Landhandel.' }
  };

  // --- SPIELLOGIK FUNKTIONEN ---

  /**
   * Berechnet den aktuellen Verkaufspreis einer Ware in einer Stadt.
   * Der Preis schwankt leicht und wird durch den Produktionsfaktor der Stadt beeinflusst.
   * @param {string} stadtName - Name der Stadt.
   * @param {string} wareName - Name der Ware.
   * @returns {number} Aktueller Preis.
   */
  function berechneAktuellenPreis(stadtName, wareName) {
    const stadt = STAEDTE[stadtName];
    const wareDaten = stadt.gueter[wareName];
    if (!wareDaten) return 0; // Ware nicht in dieser Stadt verfügbar

    let preis = wareDaten.basisPreis * (wareDaten.produktionsFaktor || 1.0); // Standard 1.0 wenn kein Faktor definiert

    // Einfache Zufallsschwankung (+/- 10% des Basispreises)
    const schwankung = Math.floor(Math.random() * (wareDaten.basisPreis * 0.2)) - (wareDaten.basisPreis * 0.1);
    preis += schwankung;

    return Math.max(1, Math.round(preis)); // Preis muss mindestens 1 sein und ganzzahlig
  }

  /**
   * Gibt die gesamte verfügbare Ladekapazität des Spielers zurück (summiert über alle Schiffe).
   * @returns {number} Freie Ladekapazität.
   */
  function getGesamtLadekapazitaet() {
    let gesamtKapazitaet = 0;
    SPIELER_DATEN.schiffeBesitz.forEach(schiff => {
      gesamtKapazitaet += schiff.kapazitaet;
    });
    return gesamtKapazitaet;
  }

  /**
   * Gibt die aktuell genutzte Ladekapazität des Spielers zurück.
   * @returns {number} Genutzte Ladekapazität.
   */
  function getAktuelleLadungsmenge() {
    let aktuelleLadung = 0;
    for (const wareName in SPIELER_DATEN.inventar) {
      aktuelleLadung += SPIELER_DATEN.inventar[wareName];
    }
    return aktuelleLadung;
  }

  /**
   * Wählt eine Stadt aus und aktualisiert die Ansicht.
   * @param {string} name - Der Name der ausgewählten Stadt.
   */
  function stadtWaehlen(name) {
    SPIELER_DATEN.aktuelleStadt = name;
    markiereAktuelleStadt(name);
    zeigeMenue('uebersicht');
  }

  /**
   * Zeigt das gewählte Menü (Übersicht, Handel, Gebäude, Schiffe) an.
   * @param {string} menuepunkt - Der Name des Menüpunkts.
   */
  function zeigeMenue(menuepunkt) {
    const inhaltDiv = document.getElementById('inhalt');

    aktualisiereSpielerStatusAnzeige(); // Immer den Spielerstatus aktualisieren

    if (!SPIELER_DATEN.aktuelleStadt && menuepunkt !== 'schiffe') {
      inhaltDiv.innerHTML = '<p>Bitte zuerst eine Stadt auf der Karte auswählen!</p>';
      return;
    }

    let htmlInhalt = '';
    const aktuelleStadtDaten = SPIELER_DATEN.aktuelleStadt ? STAEDTE[SPIELER_DATEN.aktuelleStadt] : null;

    switch (menuepunkt) {
      case 'uebersicht':
        htmlInhalt = `<h2>${SPIELER_DATEN.aktuelleStadt} – Übersicht</h2>
          <p>Einwohner: ${aktuelleStadtDaten.einwohner}</p>
          <p>Versorgung: ${aktuelleStadtDaten.versorgung}</p>`;
        break;

      case 'handel':
        htmlInhalt = `<h2>${SPIELER_DATEN.aktuelleStadt} – Handel</h2>
          <table>
            <tr><th>Ware</th><th>Preis</th><th>Stadt-Lager</th><th>Deine Menge</th><th colspan="2">Aktion</th></tr>`;
        for (const wareName in aktuelleStadtDaten.gueter) {
          const preis = berechneAktuellenPreis(SPIELER_DATEN.aktuelleStadt, wareName); // Dynamischer Preis
          const ware = aktuelleStadtDaten.gueter[wareName];
          htmlInhalt += `
              <tr>
                <td>${wareName}</td>
                <td id="preis_${wareName}">${preis} Gold</td>
                <td id="stadtLager_${wareName}">${ware.lager}</td>
                <td id="spielerMenge_${wareName}">${SPIELER_DATEN.inventar[wareName] || 0}</td>
                <td>
                  <input type="number" id="mengeKaufen_${wareName}" value="1" min="1" max="${ware.lager}" style="width: 60px;">
                  <button onclick="handelWare('${wareName}', 'kaufen')">Kaufen</button>
                </td>
                <td>
                  <input type="number" id="mengeVerkaufen_${wareName}" value="1" min="1" max="${SPIELER_DATEN.inventar[wareName] || 0}" style="width: 60px;">
                  <button onclick="handelWare('${wareName}', 'verkaufen')">Verkaufen</button>
                </td>
              </tr>`;
        }
        htmlInhalt += `</table>
        <h3>Dein Inventar:</h3>
        <table>
          <tr><th>Ware</th><th>Menge</th></tr>`;
          let inventarLeer = true;
          for (const wareName in SPIELER_DATEN.inventar) {
            if (SPIELER_DATEN.inventar[wareName] > 0) {
              htmlInhalt += `<tr><td>${wareName}</td><td>${SPIELER_DATEN.inventar[wareName]}</td></tr>`;
              inventarLeer = false;
            }
          }
          if (inventarLeer) {
            htmlInhalt += `<tr><td colspan="2">Dein Inventar ist leer.</td></tr>`;
          }
          htmlInhalt += `</table>`;
        break;

      case 'gebaeude':
        htmlInhalt = `<h2>${SPIELER_DATEN.aktuelleStadt} – Gebäude</h2>
          <h3>Besitz in ${SPIELER_DATEN.aktuelleStadt}:</h3>
          <ul>`;
          const stadtGebaeude = SPIELER_DATEN.gebaeude[SPIELER_DATEN.aktuelleStadt] || {};
          if (Object.keys(stadtGebaeude).length === 0) {
            htmlInhalt += `<li>Keine Gebäude im Besitz.</li>`;
          } else {
            for (const gebaeudeName in stadtGebaeude) {
              htmlInhalt += `<li>${gebaeudeName} (Stufe ${stadtGebaeude[gebaeudeName]})</li>`;
            }
          }
          htmlInhalt += `</ul>
          <h3>Verfügbare Gebäude zum Bau:</h3>
          <ul>`;
          for (const gebaeudeName in GEBAEUDE_TYPEN) {
            const gebaeudeTyp = GEBAEUDE_TYPEN[gebaeudeName];
            htmlInhalt += `<li>${gebaeudeName} (${gebaeudeTyp.beschreibung}) – Kosten: ${gebaeudeTyp.kosten} Gold <button onclick="gebaeudeBauen('${gebaeudeName}', ${gebaeudeTyp.kosten})">Bauen</button></li>`;
          }
          htmlInhalt += `</ul>`;
        break;

      case 'schiffe':
        htmlInhalt = `<h2>Werft – Schiffe</h2>
          <h3>Verfügbare Schiffstypen zum Kauf:</h3>
          <ul>`;
        SCHIFFS_TYPEN.forEach(schiff => {
          if (SPIELER_DATEN.level >= schiff.levelNoetig) {
            htmlInhalt += `<li>${schiff.name} (ab Level ${schiff.levelNoetig}, Kapazität: ${schiff.kapazitaet}, Preis: ${schiff.preis} Gold) <button onclick="schiffKaufen('${schiff.name}', ${schiff.preis})">Kaufen</button></li>`;
          } else {
            htmlInhalt += `<li>${schiff.name} (ab Level ${schiff.levelNoetig}, Kapazität: ${schiff.kapazitaet}, Preis: ${schiff.preis} Gold) - Benötigtes Level: ${schiff.levelNoetig}</li>`;
          }
        });
        htmlInhalt += `</ul>
          <h3>Deine Schiffe:</h3>
          <ul>`;
        if (SPIELER_DATEN.schiffeBesitz.length === 0) {
          htmlInhalt += `<li>Du besitzt noch keine Schiffe.</li>`;
        } else {
          SPIELER_DATEN.schiffeBesitz.forEach((schiff, index) => {
            htmlInhalt += `<li>${schiff.name} (Kapazität: ${schiff.kapazitaet}, Beladen: ${schiff.ladungsmenge || 0})`;
            // Optional: Hier könnte man weitere Aktionen pro Schiff einfügen (z.B. beladen, entladen, reparieren)
            htmlInhalt += `</li>`;
          });
        }
        htmlInhalt += `</ul>`;
        break;

      default:
        htmlInhalt = `<p>Ein unbekanntes Menü wurde aufgerufen.</p>`;
    }
    inhaltDiv.innerHTML = htmlInhalt;
  }

  /**
   * Führt einen Kauf oder Verkauf einer Ware aus.
   * @param {string} wareName - Der Name der Ware.
   * @param {'kaufen'|'verkaufen'} aktion - Die Aktion (kaufen oder verkaufen).
   */
  function handelWare(wareName, aktion) {
    const aktuelleStadtDaten = STAEDTE[SPIELER_DATEN.aktuelleStadt];
    const wareInStadt = aktuelleStadtDaten.gueter[wareName];

    let mengeInputId = (aktion === 'kaufen') ? `mengeKaufen_${wareName}` : `mengeVerkaufen_${wareName}`;
    let menge = parseInt(document.getElementById(mengeInputId).value);

    if (isNaN(menge) || menge <= 0) {
      alert('Bitte gib eine gültige Menge ein (mindestens 1).');
      return;
    }

    const preisProEinheit = berechneAktuellenPreis(SPIELER_DATEN.aktuelleStadt, wareName);
    const gesamtPreis = preisProEinheit * menge;

    if (aktion === 'kaufen') {
      if (SPIELER_DATEN.gold < gesamtPreis) {
        alert('Nicht genug Gold!');
        return;
      }
      if (wareInStadt.lager < menge) {
        alert('Stadt hat nicht genug Waren auf Lager!');
        return;
      }
      if (getAktuelleLadungsmenge() + menge > getGesamtLadekapazitaet()) {
          alert(`Nicht genug Ladekapazität! Du hast ${getAktuelleLadungsmenge()} / ${getGesamtLadekapazitaet()} belegt.`);
          return;
      }

      SPIELER_DATEN.gold -= gesamtPreis;
      wareInStadt.lager -= menge;
      SPIELER_DATEN.inventar[wareName] = (SPIELER_DATEN.inventar[wareName] || 0) + menge;
      aktualisiereXP(5 * menge); // Mehr XP für größere Mengen
      alert(`${menge} ${wareName} für ${gesamtPreis} Gold gekauft.`);

    } else if (aktion === 'verkaufen') {
      if (!SPIELER_DATEN.inventar[wareName] || SPIELER_DATEN.inventar[wareName] < menge) {
        alert('Du hast nicht genug dieser Ware in deinem Inventar!');
        return;
      }

      SPIELER_DATEN.gold += gesamtPreis;
      wareInStadt.lager += menge;
      SPIELER_DATEN.inventar[wareName] -= menge;
      aktualisiereXP(5 * menge);
      alert(`${menge} ${wareName} für ${gesamtPreis} Gold verkauft.`);
    }

    // Aktualisiere die Anzeigen direkt, ohne das ganze Menü neu zu rendern
    document.getElementById(`stadtLager_${wareName}`).textContent = wareInStadt.lager;
    document.getElementById(`spielerMenge_${wareName}`).textContent = SPIELER_DATEN.inventar[wareName];
    document.getElementById(`mengeKaufen_${wareName}`).setAttribute('max', wareInStadt.lager);
    document.getElementById(`mengeVerkaufen_${wareName}`).setAttribute('max', SPIELER_DATEN.inventar[wareName]);
    document.getElementById(`preis_${wareName}`).textContent = `${berechneAktuellenPreis(SPIELER_DATEN.aktuelleStadt, wareName)} Gold`; // Preis könnte sich nach Handel ändern

    aktualisiereSpielerStatusAnzeige(); // Gold/XP/Ladekapazität aktualisieren
  }

  /**
   * Baut ein Gebäude in der aktuellen Stadt.
   * @param {string} gebaeudeName - Der Name des zu bauenden Gebäudes.
   * @param {number} kosten - Die Kosten des Gebäudes.
   */
  function gebaeudeBauen(gebaeudeName, kosten) {
    if (SPIELER_DATEN.gold >= kosten) {
      if (!SPIELER_DATEN.gebaeude[SPIELER_DATEN.aktuelleStadt]) {
        SPIELER_DATEN.gebaeude[SPIELER_DATEN.aktuelleStadt] = {};
      }
      // Einfache Logik: Nur Stufe 1 Gebäude
      if (!SPIELER_DATEN.gebaeude[SPIELER_DATEN.aktuelleStadt][gebaeudeName]) {
        SPIELER_DATEN.gold -= kosten;
        SPIELER_DATEN.gebaeude[SPIELER_DATEN.aktuelleStadt][gebaeudeName] = 1; // Stufe 1
        aktualisiereXP(20);
        alert(`${gebaeudeName} in ${SPIELER_DATEN.aktuelleStadt} gebaut!`);
      } else {
        alert(`Du hast bereits ein ${gebaeudeName} in ${SPIELER_DATEN.aktuelleStadt}.`);
      }
    } else {
      alert('Nicht genug Gold, um dieses Gebäude zu bauen!');
    }
    zeigeMenue('gebaeude');
  }

  /**
   * Kauft ein Schiff für den Spieler.
   * @param {string} schiffName - Der Name des zu kaufenden Schiffstyps.
   * @param {number} preis - Der Preis des Schiffes.
   */
  function schiffKaufen(schiffName, preis) {
    const schiffTyp = SCHIFFS_TYPEN.find(s => s.name === schiffName);
    if (!schiffTyp) {
      alert('Unbekannter Schiffstyp!');
      return;
    }

    if (SPIELER_DATEN.gold >= preis && SPIELER_DATEN.level >= schiffTyp.levelNoetig) {
      SPIELER_DATEN.gold -= preis;
      SPIELER_DATEN.schiffeBesitz.push({
        name: schiffTyp.name,
        kapazitaet: schiffTyp.kapazitaet,
        ladungsmenge: 0, // Aktuell beladene Menge
        ladungsDetails: {} // Speichert z.B. {'Holz': 10, 'Getreide': 5}
      });
      aktualisiereXP(50);
      alert(`${schiffName} gekauft!`);
    } else if (SPIELER_DATEN.level < schiffTyp.levelNoetig) {
      alert(`Dein Level ist zu niedrig. Du benötigst Level ${schiffTyp.levelNoetig}, um ${schiffName} zu kaufen.`);
    } else {
      alert('Nicht genug Gold, um dieses Schiff zu kaufen!');
    }
    zeigeMenue('schiffe');
  }

  /**
   * Fügt dem Spieler XP hinzu und prüft auf Levelaufstieg.
   * @param {number} menge - Die Menge an XP, die hinzugefügt werden soll.
   */
  function aktualisiereXP(menge) {
    SPIELER_DATEN.xp += menge;
    const xpFuerNaechstesLevel = SPIELER_DATEN.level * 100; // Beispiel: 100 XP für Level 2, 200 für Level 3, etc.
    if (SPIELER_DATEN.xp >= xpFuerNaechstesLevel) {
      SPIELER_DATEN.level++;
      SPIELER_DATEN.xp -= xpFuerNaechstesLevel; // Verbleibende XP nach Levelaufstieg
      alert(`Herzlichen Glückwunsch! Du bist Level ${SPIELER_DATEN.level} aufgestiegen!`);
    }
    aktualisiereSpielerStatusAnzeige();
  }

  /**
   * Aktualisiert die Anzeige des Spielerstatus im HTML.
   */
  function aktualisiereSpielerStatusAnzeige() {
    document.getElementById('goldAnzeige').textContent = SPIELER_DATEN.gold;
    document.getElementById('levelAnzeige').textContent = SPIELER_DATEN.level;
    document.getElementById('xpAnzeige').textContent = SPIELER_DATEN.xp;
    document.getElementById('aktuelleStadtAnzeige').textContent = SPIELER_DATEN.aktuelleStadt || 'Keine';
    document.getElementById('ladekapazitaetAnzeige').textContent = `${getAktuelleLadungsmenge()} / ${getGesamtLadekapazitaet()}`;
  }

  // --- VISUELLE HILFSFUNKTIONEN ---

  let currentMarkedCity = null; // Speichert den aktuell markierten Stadtkreis

  /**
   * Markiert die ausgewählte Stadt auf der Karte visuell.
   * @param {string} stadtName - Der Name der Stadt, die markiert werden soll.
   */
  function markiereAktuelleStadt(stadtName) {
    // Entferne die Markierung von der vorherigen Stadt
    if (currentMarkedCity) {
        currentMarkedCity.setAttribute('fill', '#3366cc'); // Setze Standardfarbe zurück
        currentMarkedCity.setAttribute('r', '8'); // Setze Standardgröße zurück
    }

    // Finde den Kreis der neuen Stadt über das data-Attribut
    const neueStadtCircle = document.querySelector(`.stadt-button[data-stadt-name="${stadtName}"]`);
    if (neueStadtCircle) {
        neueStadtCircle.setAttribute('fill', '#ff0000'); // Neue Farbe (Rot) für ausgewählte Stadt
        neueStadtCircle.setAttribute('r', '12'); // Größerer Kreis
        currentMarkedCity = neueStadtCircle; // Speichere die aktuelle Stadt als markiert
    }
  }

  // --- INITIALISIERUNG DES SPIELS ---

  /**
   * Initialisiert das Spiel beim Laden der Seite.
   * Erstellt die Städte auf der Karte dynamisch und setzt die Startansicht.
   */
  document.addEventListener('DOMContentLoaded', () => {
    const karteSVG = document.getElementById('karte');

    // Dynamische Kartenerstellung (Städte)
    for (const stadtName in STAEDTE) {
      const stadtDaten = STAEDTE[stadtName];

      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      circle.setAttribute('class', 'stadt-button');
      circle.setAttribute('cx', stadtDaten.x);
      circle.setAttribute('cy', stadtDaten.y);
      circle.setAttribute('r', '8');
      circle.dataset.stadtName = stadtName; // Speichert den Stadtnamen im data-Attribut
      karteSVG.appendChild(circle);

      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', stadtDaten.x + 10);
      text.setAttribute('y', stadtDaten.y + 5);
      text.textContent = stadtName;
      text.style.pointerEvents = 'none'; // Verhindert, dass der Text Klicks abfängt
      karteSVG.appendChild(text);
    }

    // Event Listener für die Städte-Buttons (Kreise)
    document.querySelectorAll('.stadt-button').forEach(button => {
      button.addEventListener('click', (event) => {
        stadtWaehlen(event.target.dataset.stadtName);
      });
    });

    // Gib dem Spieler ein Startschiff, damit er Kapazität hat
    SPIELER_DATEN.schiffeBesitz.push({
        name: 'Schnigge',
        kapazitaet: SCHIFFS_TYPEN.find(s => s.name === 'Schnigge').kapazitaet,
        ladungsmenge: 0,
        ladungsDetails: {}
    });


    // Setze die initiale Ansicht und den Spielerstatus
    aktualisiereSpielerStatusAnzeige();
    document.getElementById('inhalt').innerHTML = '<p>Wähle eine Stadt auf der Karte, um zu beginnen.</p>';
  });
</script>

</body>
</html>
