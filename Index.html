<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Handelsspiel mit Karte und Stadtlager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f1e1;
      margin: 0;
      padding: 0;
    }
    header {
      padding: 1rem;
      background-color: #6b8e6b;
      color: white;
      text-align: center;
    }
    .map-container {
      position: relative;
      max-width: 800px;
      margin: 1rem auto;
      background: #eef;
    }
    .info-box {
      padding: 1rem;
      max-width: 800px;
      margin: auto;
    }
    .stadt-info {
      position: absolute;
      background: rgba(255,255,255,0.95);
      border: 1px solid #aaa;
      padding: 0.5rem;
      border-radius: 6px;
      top: 20px;
      left: 20px;
      display: none;
    }
    button {
      margin: 0.2rem;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: none;
      background: #6b8e6b;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #7fa87f;
    }
  </style>
</head>
<body>
  <header>
    <h1>üó∫Ô∏è Handelsspiel</h1>
  </header>

  <div class="map-container">
    <svg viewBox="0 0 500 400" style="width: 100%; height: auto;" id="karte">
      <!-- St√§dte -->
      <circle cx="100" cy="100" r="8" fill="blue" onclick="zeigeStadtInfo(0)" />
      <text x="110" y="105" font-size="12">Hafenburg</text>
      <circle cx="200" cy="80" r="8" fill="blue" onclick="zeigeStadtInfo(1)" />
      <text x="210" y="85" font-size="12">Flussfurt</text>
      <circle cx="300" cy="150" r="8" fill="blue" onclick="zeigeStadtInfo(2)" />
      <text x="310" y="155" font-size="12">Steinheim</text>
      <circle cx="400" cy="120" r="8" fill="blue" onclick="zeigeStadtInfo(3)" />
      <text x="410" y="125" font-size="12">Weinkrug</text>
      <circle cx="100" cy="250" r="8" fill="blue" onclick="zeigeStadtInfo(4)" />
      <text x="110" y="255" font-size="12">Holzwacht</text>
      <circle cx="200" cy="220" r="8" fill="blue" onclick="zeigeStadtInfo(5)" />
      <text x="210" y="225" font-size="12">Kornstedt</text>
      <circle cx="300" cy="300" r="8" fill="blue" onclick="zeigeStadtInfo(6)" />
      <text x="310" y="305" font-size="12">Eisenfels</text>
      <circle cx="400" cy="270" r="8" fill="blue" onclick="zeigeStadtInfo(7)" />
      <text x="410" y="275" font-size="12">Goldborn</text>
      <circle cx="150" cy="350" r="8" fill="blue" onclick="zeigeStadtInfo(8)" />
      <text x="160" y="355" font-size="12">Fischhafen</text>
      <circle cx="350" cy="360" r="8" fill="blue" onclick="zeigeStadtInfo(9)" />
      <text x="360" y="365" font-size="12">Tuchdorf</text>
    </svg>

    <div class="stadt-info" id="stadtInfo">
      <p id="stadtName"></p>
      <p id="reisezeit"></p>
      <p id="spezialisierung"></p>
      <button onclick="reiseStarten()">Jetzt reisen</button>
      <button onclick="stadtInfoSchliessen()">Abbrechen</button>
    </div>
  </div>

  <div class="info-box" id="spielInfo">
    <p><strong>Aktuelle Stadt:</strong> <span id="aktuelleStadt">Hafenburg</span></p>
    <p><strong>Gold:</strong> <span id="gold">100</span> | <strong>XP:</strong> <span id="xp">0</span> | <strong>Level:</strong> <span id="level">1</span></p>
    <div id="warenliste"></div>
  </div>

  <script>
    const staedte = [
      { name: "Hafenburg", spezial: "Nahrung", x: 100, y: 100 },
      { name: "Flussfurt", spezial: "Genussmittel", x: 200, y: 80 },
      { name: "Steinheim", spezial: "Baumaterial", x: 300, y: 150 },
      { name: "Weinkrug", spezial: "Genussmittel", x: 400, y: 120 },
      { name: "Holzwacht", spezial: "Baumaterial", x: 100, y: 250 },
      { name: "Kornstedt", spezial: "Nahrung", x: 200, y: 220 },
      { name: "Eisenfels", spezial: "Baumaterial", x: 300, y: 300 },
      { name: "Goldborn", spezial: "Genussmittel", x: 400, y: 270 },
      { name: "Fischhafen", spezial: "Nahrung", x: 150, y: 350 },
      { name: "Tuchdorf", spezial: "Baumaterial", x: 350, y: 360 }
    ];
    const basispreise = { "Brot": 12, "Fisch": 14, "Holz": 10, "Wein": 15, "Bier": 11, "Fleisch": 16 };
    let stadt = staedte[0];
    let gold = 100, xp = 0, level = 1, lager = {}, stadtLager = {}, ausgewaehlteStadtIndex = 0;
    staedte.forEach(s => {
      stadtLager[s.name] = {};
      for (let w in basispreise) stadtLager[s.name][w] = Math.floor(Math.random() * 50) + 10;
    });
    function zeigeStadtInfo(index) {
      const ziel = staedte[index];
      ausgewaehlteStadtIndex = index;
      document.getElementById("stadtName").textContent = `üèôÔ∏è Stadt: ${ziel.name}`;
      const dist = Math.round(Math.hypot(ziel.x - stadt.x, ziel.y - stadt.y) / 20);
      document.getElementById("reisezeit").textContent = `üï∞Ô∏è Reisezeit: ${dist} Tage`;
      document.getElementById("spezialisierung").textContent = `üì¶ Spezialisierung: ${ziel.spezial}`;
      document.getElementById("stadtInfo").style.display = "block";
    }
    function stadtInfoSchliessen() {
      document.getElementById("stadtInfo").style.display = "none";
    }
    function reiseStarten() {
      stadt = staedte[ausgewaehlteStadtIndex];
      document.getElementById("aktuelleStadt").textContent = stadt.name;
      stadtInfoSchliessen();
      renderWaren();
    }
    function preis(w) {
      const bestand = stadtLager[stadt.name][w];
      let p = basispreise[w];
      if (stadt.spezial === wareKategorie(w)) p -= 2;
      if (bestand < 10) p += 5;
      else if (bestand > 50) p -= 3;
      return Math.max(1, p);
    }
    function wareKategorie(w) {
      if (["Brot", "Fisch", "Fleisch"].includes(w)) return "Nahrung";
      if (["Wein", "Bier"].includes(w)) return "Genussmittel";
      return "Baumaterial";
    }
    function renderWaren() {
      const div = document.getElementById("warenliste");
      div.innerHTML = "";
      for (let w in basispreise) {
        const anzahl = lager[w] || 0;
        const p = preis(w);
        div.innerHTML += `<p><b>${w}</b> (Lager: ${anzahl})<br>
          <button onclick="kaufen('${w}', ${p})">Kaufen (${p} G)</button>
          <button onclick="verkaufen('${w}', ${p})">Verkaufen (${p} G)</button></p>`;
      }
    }
    function kaufen(w, p) {
      if (gold >= p && stadtLager[stadt.name][w] > 0) {
        gold -= p; lager[w] = (lager[w] || 0) + 1; stadtLager[stadt.name][w]--;
        updateUI();
      }
    }
    function verkaufen(w, p) {
      if ((lager[w] || 0) > 0) {
        gold += p; xp += p; lager[w]--; stadtLager[stadt.name][w]++;
        if (xp >= level * 100) level++;
        updateUI();
      }
    }
    function updateUI() {
      document.getElementById("gold").textContent = gold;
      document.getElementById("xp").textContent = xp;
      document.getElementById("level").textContent = level;
      renderWaren();
    }
    window.onload = updateUI;
  </script>
</body>
</html>
