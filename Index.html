```html
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Handelsspiel ‚Äì Elandor</title>
  <style>
    * { box-sizing: border-box; }
    body {
      background: url('https://raw.githubusercontent.com/ebrius0/Handelsspiel/main/file_0000000020d861fb8c92bec003f416bd%20(1).png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      font-family: 'Georgia', serif;
      margin: 0;
      padding: 0;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(244, 241, 229, 0.85);
      z-index: -1;
    }
    
    /* Top Status Bar */
    #topBar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(107, 79, 45, 0.95);
      backdrop-filter: blur(10px);
      padding: 10px 15px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.3);
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .status-badge {
      background: rgba(255, 255, 255, 0.15);
      padding: 8px 15px;
      border-radius: 20px;
      color: white;
      font-size: 0.9em;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
    }
    .status-badge span {
      color: #ffd700;
    }
    
    /* Main Layout */
    #mainContent {
      margin-top: 70px;
      padding: 10px;
    }
    nav button {
      background: rgba(139, 94, 60, 0.9);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      font-size: 15px;
      cursor: pointer;
      margin: 5px;
      border-radius: 8px;
      transition: all 0.3s;
      backdrop-filter: blur(5px);
      font-weight: bold;
    }
    nav button:hover { 
      background: rgba(169, 113, 68, 0.95); 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    nav button.danger { 
      background: rgba(200, 35, 51, 0.9); 
    }
    nav button.danger:hover { 
      background: rgba(167, 29, 42, 0.95); 
    }
    
    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      padding: 10px 5px;
      background: rgba(107, 79, 45, 0.6);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      margin: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    #weltkarteContainer {
      margin: 10px;
      border: 2px solid rgba(192, 184, 161, 0.6);
      border-radius: 12px;
      background: rgba(255, 253, 247, 0.85);
      backdrop-filter: blur(10px);
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    #weltkarteContainer h2 {
      margin-top: 0;
      color: #6b4f2d;
    }
    #karte {
      width: 100%;
      max-width: 1000px;
      height: auto;
      display: block;
      margin: 0 auto;
      border: 3px solid rgba(139, 94, 60, 0.8);
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      background: rgba(255,255,255,0.9);
    }
    
    .stadt-button {
      fill: #3366cc;
      cursor: pointer;
      transition: all 0.3s;
    }
    .stadt-button:hover {
      fill: #5588ee;
      r: 10;
    }
    .stadt-button.active {
      fill: #ff6600;
      r: 12;
    }
    
    #inhalt {
      padding: 20px;
      background: rgba(255, 253, 247, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(192, 184, 161, 0.6);
      margin: 10px;
      border-radius: 12px;
      min-height: 300px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    #inhalt h2 {
      color: #6b4f2d;
      margin-top: 0;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    td, th {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th { background-color: #8b5e3c; color: white; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    
    .btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 15px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 2px 2px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s;
    }
    .btn:hover { background: #45a049; }
    .btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    .btn-primary { background: #007bff; }
    .btn-primary:hover { background: #0056b3; }
    .btn-danger { background: #dc3545; }
    .btn-danger:hover { background: #c82333; }
    .btn-warning { background: #ffc107; color: #333; }
    .btn-warning:hover { background: #e0a800; }
    
    input[type="number"] {
      width: 70px;
      padding: 5px;
      margin-right: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: rgba(249, 249, 249, 0.95);
      backdrop-filter: blur(5px);
      border: 2px solid rgba(224, 224, 224, 0.8);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      transition: all 0.3s;
    }
    .card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    }
    .card h3 { margin-top: 0; color: #333; }
    .card-info p { margin: 5px 0; font-size: 0.9em; }
    .card-actions {
      margin-top: auto;
      padding-top: 15px;
      text-align: center;
    }
    
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 3px solid #333;
      padding: 25px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      z-index: 1000;
      text-align: center;
      max-width: 500px;
      width: 90%;
      border-radius: 10px;
      display: none;
    }
    .modal.show { display: block; }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 999;
      display: none;
    }
    .modal-overlay.show { display: block; }
    
    .alert {
      padding: 12px;
      margin: 10px 0;
      border-radius: 5px;
      border-left: 4px solid;
    }
    .alert-info { background: #d1ecf1; border-color: #0c5460; color: #0c5460; }
    .alert-warning { background: #fff3cd; border-color: #856404; color: #856404; }
    .alert-danger { background: #f8d7da; border-color: #721c24; color: #721c24; }
    .alert-success { background: #d4edda; border-color: #155724; color: #155724; }
    
    select {
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    .schiff-status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 0.85em;
      font-weight: bold;
    }
    .status-anker { background: #28a745; color: white; }
    .status-reise { background: #ffc107; color: #333; }
    
    @media (max-width: 768px) {
      #topBar {
        flex-direction: column;
        align-items: stretch;
      }
      .status-badge {
        justify-content: center;
      }
      nav button { 
        padding: 8px 12px; 
        font-size: 14px; 
      }
      #mainContent {
        margin-top: 220px;
      }
    }
    @media (min-width: 769px) {
      #mainContent {
        margin-top: 70px;
      }
    }
  </style>
</head>
<body>

<div id="topBar">
  <div class="status-badge">üí∞ <span id="goldAnzeige">0</span> Gold</div>
  <div class="status-badge">üìà Level <span id="levelAnzeige">1</span> (<span id="xpAnzeige">0</span> XP)</div>
  <div class="status-badge">‚≠ê <span id="rufRangAnzeige">-</span></div>
  <div class="status-badge">üìç <span id="aktuelleStadtAnzeige">-</span></div>
  <div class="status-badge">üìÖ Tag <span id="tagAnzeige">1</span></div>
  <div class="status-badge">‚õµ <span id="schiffeAnzeige">0</span> Schiffe</div>
</div>

<div id="mainContent">

<nav>
  <button onclick="zeigeMenue('uebersicht')">üìä √úbersicht</button>
  <button onclick="zeigeMenue('handel')">üí∞ Handel</button>
  <button onclick="zeigeMenue('gebaeude')">üèõÔ∏è Geb√§ude</button>
  <button onclick="zeigeMenue('schiffe')">‚õµ Schiffe</button>
  <button class="danger" onclick="neuesSpiel()">üîÑ Neu</button>
</nav>

<div id="weltkarteContainer">
  <h2>üó∫Ô∏è Weltkarte von Elandor</h2>
  <p style="color: #6b4f2d; font-weight: bold;">Klicke auf eine Stadt, um sie auszuw√§hlen</p>
  <svg id="karte" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
    <image href="https://raw.githubusercontent.com/ebrius0/Handelsspiel/main/file_0000000020d861fb8c92bec003f416bd%20(1).png" 
           x="0" y="0" height="600" width="1000" preserveAspectRatio="xMidYMid slice"/>
  </svg>
</div>

<div id="inhalt">
  <p>W√§hle eine Stadt auf der Karte aus, um zu beginnen.</p>
</div>

</div>

<div class="modal-overlay" id="modalOverlay"></div>
<div class="modal" id="piratenModal">
  <h3>‚öîÔ∏è PIRATENANGRIFF! ‚öîÔ∏è</h3>
  <p id="piratenText"></p>
  <div style="margin-top: 20px;">
    <button class="btn btn-danger" onclick="piratenAktion('kampf')">‚öîÔ∏è K√§mpfen</button>
    <button class="btn btn-warning" onclick="piratenAktion('flucht')">üèÉ Fliehen</button>
  </div>
</div>

<script>
// ==================== SPIELDATEN ====================
const STAEDTE = {
  'Aethelgard': { 
    x: 150, y: 120, einwohner: 1200, versorgung: 'Gut',
    gueter: {
      'Getreide': { basisPreis: 10, lager: 80, produktion: 0.7 },
      'Fisch': { basisPreis: 12, lager: 60, produktion: 0.8 },
      'Wolle': { basisPreis: 15, lager: 40, produktion: 0.9 }
    },
    verbindungen: ['Port Valerius', 'Gezeitenruh']
  },
  'Port Valerius': { 
    x: 280, y: 80, einwohner: 1500, versorgung: 'Sehr Gut',
    gueter: {
      'Holz': { basisPreis: 15, lager: 50, produktion: 0.8 },
      'Tuch': { basisPreis: 25, lager: 30, produktion: 1.0 },
      'Wein': { basisPreis: 20, lager: 20, produktion: 1.1 }
    },
    verbindungen: ['Aethelgard', 'Silberhafen']
  },
  'Silberhafen': { 
    x: 420, y: 95, einwohner: 900, versorgung: 'Mittel',
    gueter: {
      'Silbererz': { basisPreis: 40, lager: 30, produktion: 0.7 },
      'Eisen': { basisPreis: 30, lager: 20, produktion: 0.8 },
      'Kohle': { basisPreis: 20, lager: 40, produktion: 0.75 }
    },
    verbindungen: ['Port Valerius', 'Ostwall', 'Drachenbucht']
  },
  'Ostwall': { 
    x: 550, y: 130, einwohner: 1100, versorgung: 'Gut',
    gueter: {
      'Eisen': { basisPreis: 30, lager: 35, produktion: 0.8 },
      'Waffen': { basisPreis: 70, lager: 10, produktion: 0.9 },
      'Getreide': { basisPreis: 10, lager: 40, produktion: 1.0 }
    },
    verbindungen: ['Silberhafen', 'Drachenbucht', 'Sonnenk√ºste']
  },
  'Drachenbucht': { 
    x: 700, y: 180, einwohner: 1300, versorgung: 'Hervorragend',
    gueter: {
      'Wein': { basisPreis: 20, lager: 40, produktion: 0.7 },
      'Tuch': { basisPreis: 25, lager: 25, produktion: 0.9 },
      'Seide': { basisPreis: 80, lager: 10, produktion: 1.05 }
    },
    verbindungen: ['Silberhafen', 'Ostwall', 'Sonnenk√ºste', 'Wolkenfels', 'Tidenfall']
  },
  'Sonnenk√ºste': { 
    x: 850, y: 250, einwohner: 1050, versorgung: 'Gut',
    gueter: {
      'Exotische Fr√ºchte': { basisPreis: 45, lager: 30, produktion: 0.75 },
      'Juwelen': { basisPreis: 100, lager: 8, produktion: 0.8 },
      'Gew√ºrze': { basisPreis: 60, lager: 15, produktion: 1.0 }
    },
    verbindungen: ['Ostwall', 'Drachenbucht', 'Tidenfall']
  },
  'Tidenfall': { 
    x: 880, y: 380, einwohner: 950, versorgung: 'Mittel',
    gueter: {
      'Fisch': { basisPreis: 12, lager: 70, produktion: 0.7 },
      'Kr√§uter': { basisPreis: 22, lager: 50, produktion: 0.9 },
      'Salz': { basisPreis: 18, lager: 30, produktion: 0.8 }
    },
    verbindungen: ['Drachenbucht', 'Sonnenk√ºste', 'Sturmkap', 'Auenbr√ºck']
  },
  'Sturmkap': { 
    x: 800, y: 500, einwohner: 1400, versorgung: 'Sehr Gut',
    gueter: {
      'R√ºstungen': { basisPreis: 90, lager: 12, produktion: 0.8 },
      'Waffen': { basisPreis: 70, lager: 10, produktion: 0.9 },
      'Eisen': { basisPreis: 30, lager: 20, produktion: 1.0 }
    },
    verbindungen: ['Tidenfall', 'Flussfurt']
  },
  'Flussfurt': { 
    x: 350, y: 350, einwohner: 700, versorgung: 'Mittel',
    gueter: {
      'Getreide': { basisPreis: 10, lager: 90, produktion: 0.6 },
      'Holz': { basisPreis: 15, lager: 70, produktion: 0.7 },
      'Leder': { basisPreis: 20, lager: 30, produktion: 0.8 }
    },
    verbindungen: ['Sturmkap', 'Auenbr√ºck', 'Gezeitenruh']
  },
  'Auenbr√ºck': { 
    x: 550, y: 420, einwohner: 850, versorgung: 'Schlecht',
    gueter: {
      'Holz': { basisPreis: 15, lager: 60, produktion: 0.65 },
      'Kohle': { basisPreis: 20, lager: 50, produktion: 0.7 },
      'Erz': { basisPreis: 30, lager: 25, produktion: 0.8 }
    },
    verbindungen: ['Tidenfall', 'Flussfurt']
  },
  'Gezeitenruh': { 
    x: 100, y: 500, einwohner: 600, versorgung: 'Sehr Schlecht',
    gueter: {
      'Rum': { basisPreis: 80, lager: 15, produktion: 0.7 },
      'Tropische H√∂lzer': { basisPreis: 35, lager: 25, produktion: 0.7 },
      'Gew√ºrze': { basisPreis: 60, lager: 10, produktion: 0.85 }
    },
    verbindungen: ['Aethelgard', 'Flussfurt']
  },
  'Wolkenfels': { 
    x: 920, y: 70, einwohner: 750, versorgung: 'Gut',
    gueter: {
      'Perlen': { basisPreis: 60, lager: 15, produktion: 0.7 },
      'Edelsteine': { basisPreis: 110, lager: 5, produktion: 0.75 },
      'Seide': { basisPreis: 80, lager: 7, produktion: 0.8 }
    },
    verbindungen: ['Drachenbucht']
  }
};

const SCHIFFS_TYPEN = [
  { name: 'Schnigge', level: 1, kapazitaet: 50, preis: 500, waffen: 1, geschwindigkeit: 1.0 },
  { name: 'Kraier', level: 10, kapazitaet: 150, preis: 2000, waffen: 2, geschwindigkeit: 1.1 },
  { name: 'Kogge', level: 20, kapazitaet: 300, preis: 5000, waffen: 3, geschwindigkeit: 1.05 },
  { name: 'Holk', level: 30, kapazitaet: 600, preis: 10000, waffen: 4, geschwindigkeit: 0.9 }
];

const GEBAEUDE = {
  'Werft': {
    info: 'Bau und Reparatur von Schiffen',
    kosten: [200, 500, 1500],
    level: [1, 5, 15],
    max: 3,
    bonus: ['Schnigge', 'Kraier', 'Kogge']
  },
  'Lagerhaus': {
    info: 'Erh√∂ht Lagerkapazit√§t',
    kosten: [100, 300, 800],
    level: [2, 7, 18],
    max: 3,
    bonus: [50, 150, 300]
  },
  'Kontor': {
    info: 'Bessere Handelspreise',
    kosten: [200, 600, 1000],
    level: [3, 9, 20],
    max: 3,
    bonus: [0.05, 0.10, 0.15]
  }
};

const RUF_RAENGE = {
  '-5': 'Ge√§chteter', '-4': 'Wucherer', '-3': 'Zwielichtiger', 
  '-2': 'Raffgieriger', '-1': 'Schmarotzer', '0': 'Unbekannt',
  '+1': 'Redlich', '+2': 'Angesehen', '+3': 'Wohlt√§ter', 
  '+4': 'Edel', '+5': 'K√∂niglich'
};

// ==================== SPIELZUSTAND ====================
let SPIEL = {
  gold: 5000,
  level: 1,
  xp: 0,
  ruf: 0,
  tag: 1,
  aktuelleStadt: 'Aethelgard',
  schiffe: [
    {
      id: 1,
      typ: 'Schnigge',
      ort: 'Aethelgard',
      status: 'anker',
      ziel: null,
      ankunft: null,
      ladung: {}
    }
  ],
  gebaeude: {}
};

// Initialisiere Geb√§ude f√ºr alle St√§dte
for (let stadt in STAEDTE) {
  SPIEL.gebaeude[stadt] = { 'Werft': 1, 'Lagerhaus': 0, 'Kontor': 0 };
}

// Backup f√ºr St√§dte-Basislager
const STADT_BACKUP = JSON.parse(JSON.stringify(STAEDTE));

// ==================== HILFSFUNKTIONEN ====================
function speichern() {
  window.SPIEL_BACKUP = JSON.parse(JSON.stringify(SPIEL));
  window.STAEDTE_BACKUP = JSON.parse(JSON.stringify(STAEDTE));
  console.log('Spiel gespeichert (in-memory)');
}

function laden() {
  if (window.SPIEL_BACKUP) {
    SPIEL = JSON.parse(JSON.stringify(window.SPIEL_BACKUP));
    Object.assign(STAEDTE, window.STAEDTE_BACKUP);
    console.log('Spiel geladen');
  }
}

function neuesSpiel() {
  if (!confirm('Wirklich neu starten? Fortschritt geht verloren!')) return;
  
  SPIEL = {
    gold: 5000, level: 1, xp: 0, ruf: 0, tag: 1,
    aktuelleStadt: 'Aethelgard',
    schiffe: [{
      id: 1, typ: 'Schnigge', ort: 'Aethelgard',
      status: 'anker', ziel: null, ankunft: null, ladung: {}
    }],
    gebaeude: {}
  };
  
  for (let stadt in STAEDTE) {
    SPIEL.gebaeude[stadt] = { 'Werft': 1, 'Lagerhaus': 0, 'Kontor': 0 };
  }
  
  Object.assign(STAEDTE, JSON.parse(JSON.stringify(STADT_BACKUP)));
  
  aktualisiereSpieler();
  zeigeMenue('uebersicht');
  alert('‚úÖ Neues Spiel gestartet!');
}

function berechnePreis(stadtName, ware, aktion) {
  const stadt = STAEDTE[stadtName];
  if (!stadt.gueter[ware]) return 0;
  
  const w = stadt.gueter[ware];
  let preis = w.basisPreis * (w.produktion || 1.0);
  
  const maxLager = w.lager > 0 ? w.lager * 2 : 100;
  const lagerProzent = w.lager / maxLager;
  preis *= (1.5 - lagerProzent);
  
  preis *= (1 - SPIEL.ruf * 0.02);
  
  const kontor = SPIEL.gebaeude[stadtName]?.Kontor || 0;
  if (kontor > 0) {
    const bonus = GEBAEUDE.Kontor.bonus[kontor - 1];
    preis *= aktion === 'kaufen' ? (1 - bonus) : (1 + bonus);
  }
  
  return Math.max(1, Math.round(preis));
}

function getSchiffInStadt(stadtName) {
  return SPIEL.schiffe.find(s => s.ort === stadtName && s.status === 'anker');
}

function getLadungGesamt(schiff) {
  return Object.values(schiff.ladung).reduce((sum, m) => sum + m, 0);
}

function getKapazitaet(schiff) {
  const typ = SCHIFFS_TYPEN.find(t => t.name === schiff.typ);
  let kap = typ.kapazitaet;
  
  const lagerhaus = SPIEL.gebaeude[schiff.ort]?.Lagerhaus || 0;
  if (lagerhaus > 0) kap += GEBAEUDE.Lagerhaus.bonus[lagerhaus - 1];
  
  return kap;
}

function aktualisiereXP(menge) {
  SPIEL.xp += menge;
  const bedarf = SPIEL.level * 100;
  
  while (SPIEL.xp >= bedarf) {
    SPIEL.level++;
    SPIEL.xp -= bedarf;
    alert(`üéâ Level ${SPIEL.level} erreicht!`);
  }
  
  aktualisiereSpieler();
  speichern();
}

function naechsterTag() {
  SPIEL.tag++;
  
  for (let stadtName in STAEDTE) {
    const stadt = STAEDTE[stadtName];
    for (let ware in stadt.gueter) {
      const w = stadt.gueter[ware];
      const basislager = STADT_BACKUP[stadtName].gueter[ware].lager;
      const prod = Math.round(basislager * 0.05 * (w.produktion || 1.0));
      w.lager = Math.min(basislager * 2, w.lager + prod - Math.round(basislager * 0.02));
      w.lager = Math.max(0, w.lager);
    }
  }
  
  let ereignis = false;
  SPIEL.schiffe.forEach(schiff => {
    if (schiff.status === 'reise' && SPIEL.tag >= schiff.ankunft) {
      schiff.ort = schiff.ziel;
      schiff.status = 'anker';
      schiff.ziel = null;
      schiff.ankunft = null;
      alert(`‚õµ ${schiff.typ} ist in ${schiff.
